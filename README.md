# Архитектура высоконагруженной системы
## Динамика

Никогда не знаешь, что произойдет с приложением завтра. Возможно, количество пользователей увеличиться в 5 раз. Возможно, резко начнет набирать популярность второстепенная функция. И она создаст новые проблемы. Чем больше будет становиться система, тем более сложным (= менее эффективным) будет становиться долгосрочное планирование.
Успешность работы над крупным приложением подразумевает вовсе не детальное планирование всех аспектов. Основное усилие должно быть направлено на обеспечение гибкости системы. Гибкость позволит быстро вносить изменения. Это наиболее важное свойство любой быстрорастущей системы.

## Простые решения

Простые решения разрабатывать крайне сложно. Тем не менее, лучше потратить время и усилия на упрощение решений (как для разработки так и для пользователей). Гибкая система не бывает сложной.

нужно использовать правило 95%
"Инвестируйте время только в обеспечение 95% функционала. Остальные 5% отбрасывайте — это частные случаи, которые ведут к усложнению системы."

## Архитектурные решения
Масштабирование любого Web приложения — это постепенный процесс, который включает:
1 - Анализ нагрузки.
2 - Определение наиболее подверженных нагрузке участков.
3 - Вынесение таких участков на отдельные узлы и их оптимизация.
4 - Повтор пункта

### 1. Простая архитектура Web приложения
Новое приложение обычно запускается на одном сервере, на котором работают и Web сервер и база данных и само приложение:
![smngoz31ogptt70i3g 5c644a22](https://user-images.githubusercontent.com/57632162/222968383-0949ccc3-7ad5-48a3-9854-fab6c0606fd4.jpg)

### 2. Отделение базы данных
Чаще всего, первым узлом, который оказывается под нагрузкой, является база данных. Каждый запрос от пользователя к приложению — это обычно от 10 до 100 запросов к базе данных:
![smngoz23buuvm7l5t 7433e357](https://user-images.githubusercontent.com/57632162/222968443-084fd71f-eec6-4267-bcbf-199aa5315b27.jpg)
Вынесение базы данных на отдельный сервер позволит увеличить ее производительность и снизить ее негативное влияние на остальные компоненты.

### 3. Отделение Web сервера

Далее на очереди Web сервер. Его выделение на отдельный узел позволит оставить больше ресурсов для приложения (в примере — PHP):
![smngoz2vpqhmrfnnf e7691fc5](https://user-images.githubusercontent.com/57632162/222968552-75b71037-8e0c-42ec-9cd3-54a99fefb6ad.jpg)

### 4. Разделение нагрузки

При росте приложения следует разделить бекенды на несколько, и запросы пользователей будут отправляться на разные сервера.

### 5. Кэширование

Подключение серверов кэширования — одна из самых простых задач:
![smngoz178djm91hc6 f0480476](https://user-images.githubusercontent.com/57632162/222968728-c05c998a-3314-48c3-80e2-08e18af4dbeb.jpg)

### 6. Очереди задач

Очереди задач позволяют выполнять тяжелые операции асинхронно, не замедляя основного приложения.
![smngoz1eohu4e4f2d8 eab8c6a1](https://user-images.githubusercontent.com/57632162/222968775-491da4d5-f2ab-4f27-ab5f-fee3cc49d986.jpg)

Сервер очереди принимает задачи от приложения. Worker-сервера обрабатывают задачи. Их количество следует увеличивать, когда среднее количество задач в очереди будет постепенно расти.

### 7. Балансировка DNS

DNS поддерживает балансировку на основе Round Robin. Это позволяет указать несколько IP адресов принимающих Web серверов (называются фронтендами):
![smngoz6m7erap94mp 49f7b484](https://user-images.githubusercontent.com/57632162/222968826-18480bfb-0939-427e-8fd6-35581628d48a.jpg)
Для использования этого механизма, необходимо установить несколько одинаковых фронтендов.

### 8. Файловые хранилища
Загрузка и обработка файлов обычно происходит на бекенде. Когда бекендов несколько, это неудобно:
Придется помнить, на какой бекенд был загружен файл.
Загрузка и обработка файлов (например, видео или фото) может сильно снижать производительность бекенда.
Придется использовать сервера с большими дисками, в чем обычно нет необходимости для бекендов.
Правильным решением будет использование отдельных серверов для загрузки, хранения и обработки файлов:
![smngozug7d3iovvng 153afe1d](https://user-images.githubusercontent.com/57632162/222968948-67193082-81f4-4afa-8a52-5515b1a543fb.jpg)
